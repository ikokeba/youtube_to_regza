# YouTube to REGZA 変換ツール - 開発ログ

## 2025-09-16 13:09:02 - README.md 全面更新完了

### 更新内容
✅ **README.mdの大幅改善**
- プロジェクト概要の充実（特徴アイコン付き）
- 機能説明の詳細化（コア機能/高度機能の分類）
- 使用方法の拡充（コマンドライン/バッチファイル両方記載）
- プロジェクト構成図の追加
- 設定ファイルの詳細説明（自動生成/設定例）
- トラブルシューティングの大幅改善（具体的なエラーメッセージ/解決方法）
- 更新履歴の詳細化（最新変更の反映）
- 技術仕様の追加（依存関係/システム要件）
- ユーザビリティの向上（より使いやすい構成に）

### 更新の目的
- 最新の機能追加（設定ファイル/タイトル取得/バッチファイル）を反映
- ユーザーの利便性向上
- トラブルシューティングの充実
- プロジェクトの透明性向上

---

## 2025-09-16 12:49:55 - REGZA互換性問題修正完了

### 問題の特定と修正
**問題**: 設定ファイル化後にREGZA 40V30で再生できなくなった
**原因**: REGZA 40V30互換性を損なう設定変更
- 解像度: `640x480` → `1920x1080` (高解像度は古いREGZAで非対応)
- プロファイル: `baseline` → `high` (REGZA 40V30はBaseline Profile推奨)
- レベル: `3.1` → `4.0` (REGZA 40V30はLevel 3.1推奨)

**修正内容**:
- `config.json`をREGZA 40V30互換設定に戻す
- 解像度: `640x480` (4:3アスペクト比)
- プロファイル: `baseline` (Constrained Baseline)
- レベル: `3.1`

### 修正後のテスト結果
- **テスト動画**: https://youtu.be/wg0yAiMerhg?si=yHzf1JccVNFfMx7o
- **出力先**: NAS DLNA共有フォルダ（直接保存）
- **解像度**: 640x480 (REGZA 40V30互換)
- **プロファイル**: Constrained Baseline, Level 3.1
- **ファイルサイズ**: 23.7MB
- **変換時間**: 約8.2秒
- **動作確認**: ✅ REGZA 40V30で再生可能

### REGZA 40V30推奨設定
```json
{
    "video_settings": {
        "resolution": "640x480",
        "codec": "libx264",
        "profile": "baseline",
        "level": "3.1",
        "framerate": "29.97",
        "quality": "20",
        "audio_codec": "copy"
    }
}
```

---

## 2025-09-16 12:11:01 - 設定ファイルシステム実装完了

### 実装内容
1. **設定ファイルシステム**
   - `config.json`: ユーザー設定ファイル（gitignore登録済み）
   - `config_sample.json`: サンプル設定ファイル（git管理対象）
   - 自動設定ファイル生成機能

2. **設定可能項目**
   - **出力ディレクトリ**: 動画保存先パス
   - **一時ディレクトリ**: ダウンロード一時保存先
   - **動画設定**: 解像度、コーデック、プロファイル、レベル、フレームレート、品質、音声コーデック
   - **高度設定**: 自動クリーンアップ、上書き、プログレス表示

3. **技術修正**
   - ffmpegフィルター設定の修正（解像度解析機能追加）
   - 1920x1080高解像度対応
   - H.264 High Profile Level 4.0対応

### テスト結果
- **テスト動画**: https://youtu.be/wg0yAiMerhg?si=yHzf1JccVNFfMx7o
- **出力先**:DLNA共有フォルダ（直接保存）
- **解像度**: 1920x1080 (Full HD)
- **ファイルサイズ**: 71.7MB
- **変換時間**: 約24.6秒
- **動作確認**: ✅ 全て正常

### 設定ファイル例
```json
{
    "output_directory": "./",
    "temp_directory": "./",
    "video_settings": {
        "resolution": "1920x1080",
        "codec": "libx264",
        "profile": "high",
        "level": "4.0",
        "framerate": "29.97",
        "quality": "20",
        "audio_codec": "copy"
    },
    "advanced_settings": {
        "auto_cleanup": true,
        "overwrite_existing": true,
        "show_progress": true
    }
}
```

---

## 2025-09-16 12:04:25 - 機能拡張完了

### 実装内容
1. **動画タイトル取得機能**
   - YouTube動画のタイトルを自動取得
   - ファイル名に使用できない文字を自動置換（`<>:"/\|?*` → `_`）
   - 長すぎるタイトルは100文字で切り詰め

2. **出力ファイル名変更**
   - 従来: `output_regza.mp4`
   - 新仕様: `[動画タイトル].mp4`
   - 例: `♪かみなりどんがやってきた〈鈴木翼・福田翔×ボンボンアカデミーコラボ〉かみなりどんが やってきた ドンドコドン ドンドコドン～♪【手あそび・あそび歌】.mp4`

3. **バッチファイル作成**
   - `youtube_to_regza.bat` を作成
   - ダブルクリックで実行可能
   - UTF-8エンコーディング対応
   - ユーザーフレンドリーなCLIインターフェース

### テスト結果
- **テスト動画**: https://youtu.be/7VTTXQqCxs4?si=HtsSuoaEsKHaxJEd
- **取得タイトル**: ♪かみなりどんがやってきた〈鈴木翼・福田翔×ボンボンアカデミーコラボ〉かみなりどんが やってきた ドンドコドン ドンドコドン～♪【手あそび・あそび歌】
- **出力ファイル**: 正常生成（30.6MB）
- **変換時間**: 約8.6秒
- **動作確認**: ✅ 全て正常

### 使用方法
1. **コマンドライン**: `uv run python youtube_to_regza.py <YouTube_URL>`
2. **バッチファイル**: `youtube_to_regza.bat` をダブルクリック → URL入力

---

## 2025-09-16 11:56:27 - 新規動画での動作テスト完了

### 実行内容
1. **テスト動画**: https://youtu.be/7VTTXQqCxs4?si=HtsSuoaEsKHaxJEd
2. **変換結果**: ✅ 成功
   - 出力ファイル: output_regza.mp4 (30.6MB)
   - 動画時間: 2分10秒
   - 解像度: 640x480 (4:3アスペクト比)
   - 動画コーデック: H.264 Baseline Profile Level 3.1
   - フレームレート: 29.97fps
   - 音声コーデック: AAC LC
   - 音声ビットレート: 128kbps
   - サンプリングレート: 44.1kHz
   - チャンネル: ステレオ

3. **技術詳細**
   - 元動画: AV1 1920x1080 → H.264 640x480変換
   - 変換時間: 約8.6秒
   - 変換速度: 15.1x (リアルタイム比)
   - 品質設定: CRF 20
   - 一時ファイル自動削除: 正常動作

### 動作確認結果
- yt-dlpによる動画ダウンロード: ✅ 正常動作
- ffmpegによるREGZA仕様変換: ✅ 正常動作
- 一時ファイルの自動削除: ✅ 正常動作
- 出力ファイル生成: ✅ 正常動作
- REGZA 40V30互換性: ✅ 仕様適合

---

## 2025-09-12 11:36:06 - 環境構築とテスト完了

### 実行内容
1. **uv環境構築**
   - Python 3.11でプロジェクト初期化
   - yt-dlp依存関係をインストール
   - .gitignoreファイル作成（.venv/を除外）

2. **スクリプトテスト**
   - ヘルプメッセージ表示テスト: ✅ 成功
   - 実際のYouTube動画変換テスト: ✅ 成功
   - テスト動画: Rick Astley - Never Gonna Give You Up
   - 変換結果: output_regza.mp4 (38.8MB, 640x480, H.264 Baseline Profile)

3. **動作確認結果**
   - yt-dlpによる動画ダウンロード: 正常動作
   - ffmpegによるREGZA仕様変換: 正常動作
   - 一時ファイルの自動削除: 正常動作
   - 出力ファイル生成: 正常動作

### 技術仕様
- **入力**: YouTube URL
- **出力**: REGZA 40V30対応MP4ファイル
- **変換設定**:
  - 解像度: 640x480 (アスペクト比維持)
  - コーデック: H.264 Baseline Profile Level 3.1
  - フレームレート: 29.97fps
  - 音声: AAC 128kbps, 44.1kHz, ステレオ
  - 品質: CRF 20

### 環境要件
- Python 3.11+
- uv (パッケージ管理)
- ffmpeg (外部依存)
- yt-dlp (Python依存)

### 次のステップ
- README.md完成
- 初回コミット

---

## 2025-09-20 17:23:11 - 同時実行対応と進捗表示機能追加完了

### 実装内容
1. **同時実行対応**
   - 一時ファイル名にタイムスタンプ（ミリ秒）とプロセスIDを追加
   - ファイル名形式: `temp_video_{timestamp}_{process_id}.mp4`
   - 例: `temp_video_1758356515643_476.mp4`
   - 複数のバッチファイルを同時実行してもファイル名衝突なし

2. **進捗表示機能（tqdm）**
   - tqdmライブラリを依存関係に追加
   - ffmpeg変換時の進捗バー表示
   - 動画のDuration情報を解析して進捗計算
   - yt-dlpダウンロード時の進捗表示も有効化

3. **技術改善**
   - ffmpegの進捗解析ロジック改善
   - Duration情報の正確な取得と表示
   - エラーハンドリングの強化

### 変更ファイル
- `pyproject.toml`: tqdm依存関係追加
- `youtube_to_regza.py`: 同時実行対応と進捗表示機能実装

### 使用方法
- **単一実行**: `youtube_to_regza.bat` をダブルクリック
- **同時実行**: 複数のバッチファイルを同時起動可能
- **進捗表示**: ダウンロードと変換の両方で進捗バー表示